---
title: Consuming a Service from a Client Application
---

_Refer to the sample applications in the <a href="https://github.com/spring-cloud-samples/greeting/tree/0.1.1-BETA">"greeting" repository</a> to follow along with the code in this subtopic._

Follow the below instructions to consume a service registered with the Service Registry from a Spring application.

## Declare Dependencies

To consume a service which is registered with a Service Registry instance, a Spring application must include the `spring-cloud-services-starter-parent` BOM and declare `spring-cloud-services-starter-service-registry` as a dependency.

If using Maven, <a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/pom.xml#L14-L30">include in `pom.xml`</a>:

```xml
  <parent>
    <groupId>io.pivotal.spring.cloud</groupId>
    <artifactId>spring-cloud-services-starter-parent</artifactId>
    <version>1.0.0.M1</version>
    <relativePath/> <!-- lookup parent from repository -->
  </parent>
  ...
  <dependencies>
    <dependency>
      <groupId>io.pivotal.spring.cloud</groupId>
      <artifactId>spring-cloud-services-starter-service-registry</artifactId>
    </dependency>
    ...
```

If using Gradle, <a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/build.gradle#L20-L40">include in `build.gradle`</a>:

```groovy
dependencyManagement {
    imports {
        mavenBom "io.pivotal.spring.cloud:spring-cloud-services-starter-parent:1.0.0.M1"
    }
}

...

dependencies {
    ...
    compile("io.pivotal.spring.cloud:spring-cloud-services-starter-service-registry")
}
```

(This will require <a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/build.gradle#L5-L13">use of the Gradle dependency management plugin</a>.)

You will also need to add `repo.spring.io/libs-snapshot` as a repository. <a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/pom.xml#L53-L61">Using Maven</a>:

```xml
  <repositories>
    <repository>
      <id>spring-snapshots</id>
      <url>https://repo.spring.io/libs-snapshot</url>
      <snapshots>
        <enabled>true</enabled>
      </snapshots>
    </repository>
  </repositories>
```

<a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/build.gradle#L29-L34">Using Gradle</a>:

```java
repositories {
    ...
    maven {
        url "https://repo.spring.io/libs-snapshot"
    }
}
```

The dependencies bring in the Spring Cloud Netflix client library for <a href="https://github.com/Netflix/eureka">Eureka</a>, as well as the Spring Cloud Connectors Cloud Foundry Connector and Spring Cloud Services Connector. See the <a href="/spring-cloud-services/circuit-breaker/connectors.html">Spring Cloud Connectors</a> subtopic for more information.


## Discover and Consume a Service

A consuming application must <a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/src/main/java/camelboy/CamelboyApplication.java#L19-L25">include the ```@EnableDiscoveryClient``` annotation on a configuration class</a>.

```java
@SpringBootApplication
@EnableDiscoveryClient
@RestController
public class CamelboyApplication {

    @Autowired
    private RestTemplate rest;
    //...
```

To call a registered service, a consuming application can use a URI with a hostname matching the name with which the service is registered in the Service Registry. This way, the consuming application does not need to know the service application's actual URL; the Registry will take care of finding and routing to the service.

The Expedition application is registered with the Service Registry instance as **expedition**, so in the Camelboy application, <a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/src/main/java/camelboy/CamelboyApplication.java#L31-L41">the `hello()` method on the `CamelboyApplication` class</a> uses the base URI `http://expedition` to get a greeting message from Expedition.

```java
    @RequestMapping(value = "/hello", method = RequestMethod.GET)
    public String hello(@RequestParam(value="salutation",
                                        defaultValue="Hello") String salutation,
                        @RequestParam(value="name",
                                        defaultValue="camel boy") String name) {
        URI uri = UriComponentsBuilder.fromUriString("http://expedition/greeting")
            .queryParam("salutation", salutation)
            .queryParam("name", name)
            .build()
            .toUri();

        Greeting greeting = rest.getForObject(uri, Greeting.class);
        return greeting.getMessage();
    }
```

<a href="https://github.com/spring-cloud-samples/greeting/blob/0.1.1-BETA/camelboy/src/main/java/camelboy/CamelboyApplication.java#L43-L56">Camelboy's `Greeting` class</a> uses Jackson's <a href="http://fasterxml.github.io/jackson-annotations/javadoc/2.1.0/com/fasterxml/jackson/annotation/JsonCreator.html">`@JsonCreator`</a> and <a href="http://fasterxml.github.io/jackson-annotations/javadoc/2.1.0/com/fasterxml/jackson/annotation/JsonProperty.html">`@JsonProperty`</a> to read in the JSON response from Expedition.

```java
    private static class Greeting {

        private String message;

        @JsonCreator
        public Greeting(@JsonProperty("message") String message) {
            this.message = message;
        }

        public String getMessage() {
            return this.message;
        }

    }
```

The Camelboy application now responds with a customizable `Greeting` when we access its `/hello` endpoint.

<pre class="terminal">
$ curl http://camelboy.wise.com/hello
Hello, camel boy!

$ curl http://camelboy.wise.com/hello?name=Jesse
Hello, Jesse!
</pre>
